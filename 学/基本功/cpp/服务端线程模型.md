# 背景
最开始做后台服务开发时很多东西都不理解，例如：
1. 为什么要用RPC不用HTTP?
2. 为什么需要名字服务?
3. 为什么单线程测性能很好，正式上线并发上不去？
4. 负载均衡是什么?AB Test是什么？怎么做？
5. 怎么监控异常？怎么回滚?
6. 还有很多不知己不知的东西...

这些看起来很小白的东西，即使现在能说点皮毛，也不敢说自己真的就理解透了。上学时看过一点陈硕的《Linux多线程服务端编程》，那时候没有一点工程经验，完全不能理解里面的大部分东西，基本上没留下什么印象。

最近在多看买了本电子版，重新学习了下。踩过一些坑再来看，更能体会作者的经验。


# one loop per thread + thread pool
新建连接由前端分配给某个loop，请求在loop内处理或提交给线程池。

优点：
1. 同一连接不必考虑并发问题

缺点：
1. 需要提前规划好每个loop处理的请求类型，避免阻塞/长尾请求造成排队。
2. 异步编程困难

# M:N线程库
每一个请求一个轻量级线程，不分IO和处理线程

一般服务端请求处理既有异步
1. 访问IO
2. 下游服务

也有同步请求
1. 处理时间短的handler，例如Redis大量O(1)复杂度的命令。
2. 长时间计算，例如机器学习预测，这种任务的最大并发量一般等于CPU物理核数

M:N模型能隔离请求间的影响，与上一种模型最显著的特点在于
1. 同步长时间计算不影响高优先级的短时间处理
2. 编程模型简单，不需要特别费心安排连接在哪个loop内运行。